<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice {{ invoice.invoice_number }}</title>
    <style>
        @page {
            size: A4;
            margin: 1.5cm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            font-size: 10pt;
            line-height: 1.4;
            color: #333;
            background: #fff;
        }
        
        .invoice-container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        /* Header Section */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .header-left {
            flex: 1;
        }
        
        .invoice-title {
            font-size: 28pt;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
            line-height: 1.1;
        }
        
        .customer-section {
            margin-top: 10px;
        }
        
        .customer-name {
            font-size: 12pt;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
        }
        
        .customer-address {
            font-size: 9pt;
            color: #666;
            line-height: 1.6;
        }
        
        .header-right {
            text-align: right;
            flex: 1;
        }
        
        .company-name {
            font-size: 14pt;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .company-details {
            font-size: 8pt;
            color: #666;
            line-height: 1.5;
            text-align: right;
            margin-bottom: 12px;
        }
        
        .invoice-info-box {
            display: inline-block;
            padding: 0;
        }
        
        .invoice-info {
            font-size: 9pt;
            color: #333;
            line-height: 1.6;
            text-align: left;
        }
        
        .invoice-info-row {
            margin-bottom: 4px;
        }
        
        .invoice-info-label {
            font-weight: 500;
            display: inline-block;
            width: 110px;
            color: #666;
        }
        
        /* Items Table */
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 9pt;
        }
        
        .items-table thead {
            background-color: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }
        
        .items-table th {
            padding: 8px 6px;
            text-align: left;
            font-weight: 600;
            font-size: 8pt;
            color: #333;
        }
        
        .items-table th:last-child,
        .items-table td:last-child {
            text-align: right;
        }
        
        .items-table th:nth-child(2),
        .items-table th:nth-child(3),
        .items-table th:nth-child(4),
        .items-table th:nth-child(5) {
            text-align: right;
        }
        
        .items-table tbody tr {
            border-bottom: 1px solid #eee;
        }
        
        .items-table td {
            padding: 8px 6px;
            font-size: 9pt;
        }
        
        .items-table td:nth-child(2),
        .items-table td:nth-child(3),
        .items-table td:nth-child(4),
        .items-table td:nth-child(5) {
            text-align: right;
        }
        
        .items-table .summary-row {
            background-color: #f9f9f9;
            font-weight: 500;
        }
        
        .items-table .total-row {
            background-color: #f0f0f0;
            font-weight: bold;
            font-size: 10pt;
            border-top: 2px solid #333;
        }
        
        /* Payment Section - Compact */
        .payment-section {
            margin-top: 15px;
            margin-bottom: 15px;
        }
        
        .payment-info {
            font-size: 9pt;
            color: #333;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .payment-content {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        
        .payment-instructions {
            flex: 1;
            padding: 12px 0;
        }
        
        .payment-instructions-title {
            font-size: 10pt;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .payment-instructions-content {
            white-space: pre-wrap;
            line-height: 1.5;
            color: #333;
            font-size: 9pt;
            margin-bottom: 10px;
        }
        
        .payment-reference {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }
        
        .payment-reference-title {
            font-size: 8pt;
            color: #666;
            margin-bottom: 6px;
            font-weight: 600;
        }
        
        .payment-reference-list {
            margin: 0;
            padding-left: 18px;
            font-size: 8pt;
            color: #333;
            line-height: 1.5;
        }
        
        /* Payment Advice Section - Compact */
        .payment-advice-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px dashed #999;
            font-size: 8pt;
        }
        
        .payment-advice-header {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .payment-advice-title {
            font-size: 10pt;
            font-weight: bold;
            color: #333;
        }
        
        .payment-advice-content {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            line-height: 1.6;
        }
        
        .payment-advice-left {
            flex: 1;
        }
        
        .payment-advice-right {
            flex: 1;
            text-align: right;
        }
        
        .payment-advice-label {
            font-weight: 500;
            margin-right: 8px;
        }
        
        .payment-advice-field {
            border-bottom: 1px solid #ccc;
            display: inline-block;
            min-width: 100px;
            margin-bottom: 4px;
        }
        
        /* Utility Classes */
        .text-right {
            text-align: right;
        }
        
        .text-bold {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="invoice-title">TAX INVOICE</div>
                <div class="customer-section">
                    <div class="customer-name">
                        {% if invoice.customer.user %}
                            {{ invoice.customer.user.get_full_name|default:invoice.customer.user.username }}
                        {% elif invoice.customer.company_name %}
                            {{ invoice.customer.company_name }}
                        {% else %}
                            {{ invoice.customer }}
                        {% endif %}
                    </div>
                    {% if invoice.order and invoice.order.shipping_address %}
                        <div class="customer-address">
                            {% with address=invoice.order.shipping_address %}
                                {% if address.address_line1 %}{{ address.address_line1 }}<br>{% endif %}
                                {% if address.address_line2 %}{{ address.address_line2 }}<br>{% endif %}
                                {% if address.city %}{{ address.city }}{% endif %}
                                {% if address.state %}, {{ address.state }}{% endif %}
                                {% if address.postal_code %} {{ address.postal_code }}{% endif %}<br>
                                {% if address.country %}{{ address.country|upper }}{% endif %}
                            {% endwith %}
                        </div>
                    {% elif invoice.customer.user.email %}
                        <div class="customer-address">
                            {{ invoice.customer.user.email }}
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="header-right">
                {% if invoice.brand %}
                    <div class="company-name">{{ invoice.brand.name }}</div>
                    {% if invoice.brand.address %}
                        <div class="company-details">
                            {% if invoice.brand.address.full_name %}
                                Attention: {{ invoice.brand.address.full_name }}<br>
                            {% endif %}
                            {% if invoice.brand.address.address_line1 %}{{ invoice.brand.address.address_line1 }}<br>{% endif %}
                            {% if invoice.brand.address.address_line2 %}{{ invoice.brand.address.address_line2 }}<br>{% endif %}
                            {% if invoice.brand.address.city %}{{ invoice.brand.address.city }}{% endif %}
                            {% if invoice.brand.address.state %}, {{ invoice.brand.address.state }}{% endif %}
                            {% if invoice.brand.address.postal_code %} {{ invoice.brand.address.postal_code }}{% endif %}<br>
                            {% if invoice.brand.address.country %}{{ invoice.brand.address.country|upper }}{% endif %}
                        </div>
                    {% endif %}
                {% elif invoice.workspace %}
                    <div class="company-name">{{ invoice.workspace.name }}</div>
                {% endif %}
                <div class="invoice-info-box">
                    <div class="invoice-info">
                        <div class="invoice-info-row">
                            <span class="invoice-info-label">Invoice Date</span>
                            <span>{{ invoice.issue_date|date:"d M Y" }}</span>
                        </div>
                        <div class="invoice-info-row">
                            <span class="invoice-info-label">Invoice Number</span>
                            <span>{{ invoice.invoice_number }}</span>
                        </div>
                        {% if invoice.customer.customer_number %}
                        <div class="invoice-info-row">
                            <span class="invoice-info-label">Customer Number</span>
                            <span>{{ invoice.customer.customer_number }}</span>
                        </div>
                        {% endif %}
                        {% if invoice.brand and invoice.brand.tax_id %}
                        <div class="invoice-info-row">
                            <span class="invoice-info-label">GST Number</span>
                            <span>{{ invoice.brand.tax_id }}</span>
                        </div>
                        {% endif %}
                        {% if invoice.due_date %}
                        <div class="invoice-info-row">
                            <span class="invoice-info-label">Due Date</span>
                            <span>{{ invoice.due_date|date:"d M Y" }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Items Table with Totals -->
        <table class="items-table">
            <thead>
                <tr>
                    <th>Description</th>
                    <th>Quantity</th>
                    <th>Unit Price</th>
                    <th>GST</th>
                    <th>Amount {{ invoice.currency.code }}</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>{{ item.description }}</td>
                    <td>{{ item.quantity|floatformat:2 }}</td>
                    <td>{{ invoice.currency.symbol }}{{ item.unit_price|floatformat:2 }}</td>
                    <td>
                        {% if item.tax_type == 'default' %}
                            {% if item.tax > 0 and item.subtotal > 0 %}
                                {% widthratio item.tax item.subtotal 100 %}%
                            {% elif invoice.tax > 0 and invoice.subtotal > 0 %}
                                {% widthratio invoice.tax invoice.subtotal 100 %}%
                            {% else %}
                                15%
                            {% endif %}
                        {% else %}
                            0%
                        {% endif %}
                    </td>
                    <td>{{ invoice.currency.symbol }}{{ item.subtotal|floatformat:2 }}</td>
                </tr>
                {% endfor %}
                
                <!-- Summary Rows -->
                <tr class="summary-row">
                    <td colspan="4" class="text-right">Subtotal</td>
                    <td class="text-right">{{ invoice.currency.symbol }}{{ invoice.subtotal|floatformat:2 }}</td>
                </tr>
                
                {% if invoice.order %}
                    {% if invoice.order.shipping_cost and invoice.order.shipping_cost > 0 %}
                    <tr class="summary-row">
                        <td colspan="4" class="text-right">Shipping</td>
                        <td class="text-right">{{ invoice.currency.symbol }}{{ invoice.order.shipping_cost|floatformat:2 }}</td>
                    </tr>
                    {% endif %}
                    {% if invoice.order.discount and invoice.order.discount > 0 %}
                    <tr class="summary-row">
                        <td colspan="4" class="text-right">Discount</td>
                        <td class="text-right">-{{ invoice.currency.symbol }}{{ invoice.order.discount|floatformat:2 }}</td>
                    </tr>
                    {% endif %}
                {% endif %}
                
                {% if invoice.tax > 0 %}
                <tr class="summary-row">
                    <td colspan="4" class="text-right">
                        TOTAL GST 
                        {% if invoice.subtotal > 0 %}
                            {% widthratio invoice.tax invoice.subtotal 100 %}
                        {% else %}
                            15
                        {% endif %}%
                    </td>
                    <td class="text-right">{{ invoice.currency.symbol }}{{ invoice.tax|floatformat:2 }}</td>
                </tr>
                {% endif %}
                
                <tr class="total-row">
                    <td colspan="4" class="text-right">TOTAL {{ invoice.currency.code }}</td>
                    <td class="text-right">{{ invoice.currency.symbol }}{{ invoice.total|floatformat:2 }}</td>
                </tr>
            </tbody>
        </table>
        
        <!-- Payment Section - Combined -->
        {% if invoice.brand and invoice.brand.invoice_note %}
        <div class="payment-section">
            <div class="payment-instructions">
                <div class="payment-instructions-title">Payment Instructions</div>
                <div class="payment-instructions-content">{{ invoice.brand.invoice_note }}</div>
                <div class="payment-reference">
                    <div class="payment-reference-title">Payment Reference:</div>
                    <ul class="payment-reference-list">
                        <li><strong>Particular:</strong> {% if invoice.customer.company_name %}{{ invoice.customer.company_name }}{% else %}{{ invoice.customer.user.get_full_name|default:invoice.customer.user.username }}{% endif %}</li>
                        <li><strong>Reference:</strong> {{ invoice.invoice_number }}</li>
                        <li><strong>Code:</strong> {% if invoice.customer.customer_number %}{{ invoice.customer.customer_number }}{% else %}Invoice {{ invoice.invoice_number }}{% endif %}</li>
                    </ul>
                </div>
            </div>
        </div>
        {% endif %}
        
        {% if invoice.notes %}
        <div class="payment-info">
            <div>{{ invoice.notes }}</div>
        </div>
        {% endif %}
        
        <!-- Payment Advice Section - Simplified -->
        <div class="payment-advice-section">
            <div class="payment-advice-header">
                <div class="payment-advice-title">PAYMENT ADVICE</div>
            </div>
            
            <div class="payment-advice-content">
                <div class="payment-advice-left">
                    <div><strong>To:</strong> 
                        {% if invoice.brand %}
                            {{ invoice.brand.name }}
                        {% elif invoice.workspace %}
                            {{ invoice.workspace.name }}
                        {% endif %}
                    </div>
                </div>
                
                <div class="payment-advice-right">
                    <div>
                        <span class="payment-advice-label">Customer</span>
                        <span>
                            {% if invoice.customer.user %}
                                {{ invoice.customer.user.get_full_name|default:invoice.customer.user.username }}
                            {% elif invoice.customer.company_name %}
                                {{ invoice.customer.company_name }}
                            {% else %}
                                {{ invoice.customer }}
                            {% endif %}
                        </span>
                    </div>
                    <div>
                        <span class="payment-advice-label">Invoice Number</span>
                        <span>{{ invoice.invoice_number }}</span>
                    </div>
                    <div>
                        <span class="payment-advice-label">Amount Due</span>
                        <span>{{ invoice.currency.symbol }}{{ invoice.total|floatformat:2 }}</span>
                    </div>
                    <div style="margin-top: 8px;">
                        <div><strong>Amount Enclosed</strong></div>
                        <div class="payment-advice-field" style="margin-top: 3px; width: 120px;">&nbsp;</div>
                    </div>
                    <div style="margin-top: 3px; font-size: 7pt; color: #999; font-style: italic;">
                        Enter the amount you are paying above
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
